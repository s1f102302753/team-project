{% extends 'notices/base.html' %}
{% load static %}

{% block title %}新規投稿 - デジタル回覧板{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'notices/css/base.css' %}">
<link rel="stylesheet" href="{% static 'notices/css/posts.css' %}">

<div class="container">
  <!-- 左側: カテゴリ -->
  <div class="sidebar">
    <h3>カテゴリ</h3>
    <ul>
      <li><a href="#">自治体からのお知らせ</a></li>
      <li><a href="#">チャットボット</a></li>
      <li><a href="#">防災情報</a></li>
      <li><a href="#">地域イベント</a></li>
    </ul>
  </div>

  <!-- 右側: 投稿フォーム -->
  <div class="main-content">
    <h2>新規投稿</h2>
    <form method="post">
      {% csrf_token %}
      <p>タイトル: <input type="text" name="title" required></p>
      <p>内容: <textarea name="content" rows="5" required></textarea></p>
      <button type="submit">投稿</button>
    </form>
    <p><a href="{% url 'notices:post_list' %}">一覧に戻る</a></p>
  </div>
</div>
{% endblock %}

<script>
const ws = new WebSocket("ws://localhost:8888");

ws.onmessage = e => {
  const data = JSON.parse(e.data);

  if (data.type === "POST") {
    alert("新しい投稿が届きました: " + data.text);
    // 本来はDOMに追加する
  }
};

const form = document.querySelector("form");

form.addEventListener("submit", e => {
  e.preventDefault(); // ★ Django送信を止める

  const title = form.title.value;
  const content = form.content.value;

  ws.send(JSON.stringify({
    type: "POST",
    text: title + " : " + content
  }));

  form.reset();
});
</script>